# 经验教训库 (Lessons Learned) — 自进化版

按模块组织 Bug 修复经验，避免重复踩坑。**增强特性**：严重级别标记、出现次数追踪、自动升级为强制规则。

## 📁 分类文件

| 文件名 | 内容范围 |
|--------|---------|
| `manifest.md` | Manifest V3 配置、权限声明、CSP 策略、扩展生命周期 |
| `content-script.md` | DOM 操作、页面注入、消息通信、脚本隔离 |
| `api-intercept.md` | TikTok API 拦截、数据解析、网络请求、响应处理 |
| `popup-ui.md` | Popup 界面、用户交互、导出功能、状态管理 |

## 📝 记录格式（增强版）

```markdown
### [YYYY-MM-DD] 问题简述
- **严重级别**: 🔴 严重 | 🟡 中等 | 🟢 轻微
- **出现次数**: 1
- **问题**: 具体描述发生了什么
- **根因**: 为什么会发生这个问题
- **解决**: 采取了什么修复措施
- **预防**: 未来如何避免类似问题
- **关键词**: manifest, permissions, CSP
```

### 严重级别定义

| 级别 | 含义 | 示例 |
|------|------|------|
| 🔴 严重 | 导致扩展无法加载/崩溃/数据丢失 | manifest 配置错误导致扩展无法安装 |
| 🟡 中等 | 功能异常但扩展可用 | API 拦截遗漏某些请求格式 |
| 🟢 轻微 | 不影响核心功能的小问题 | UI 样式偏差、文案错误 |

## 🔄 自动升级规则

当同一问题（相同根因）的**出现次数 ≥ 3** 时：

1. AI 自动将该教训提炼为强制规则
2. 写入 `.claude/CLAUDE.md` 的「🚨 强制规则」区域
3. 在原 lesson 条目标注 `⬆️ 已升级为规则`
4. 通知用户升级结果

**升级判定标准**：
- 相同根因的不同表现算同一问题
- 跨文件的同类问题可合并计数
- AI 判断是否属于同类问题，如有疑问询问用户

## 🔍 使用流程

### 修复 Bug 前
1. 搜索关键词，查看是否有类似历史问题
2. 如有，参考历史解决方案避免重复踩坑

### 修复 Bug 后
1. 在对应分类文件追加记录（使用增强版格式）
2. 检查是否存在类似历史教训 → 如有，增加出现次数
3. 如出现次数 ≥ 3 → 触发自动升级流程

### 新会话开始时
1. 读取所有 lessons 文件，了解历史问题
2. 检查是否有待升级的教训（出现次数 ≥ 3 但未升级）
3. 如有，执行升级并通知用户
